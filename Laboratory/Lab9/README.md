The implemented code is actually working only for K = 1.